# 飞书多维表格配置指南

## 📋 需要的配置信息

要使用飞书多维表格导入功能，你需要获取以下三个配置信息：

### 1. 应用Token (App Token)
- **位置**: 在飞书多维表格的URL中
- **格式**: 类似 `DaRUb3J4Ba7G7FsMVlpcFJolnzd`
- **获取方法**: 
  1. 打开你的飞书多维表格
  2. 查看浏览器地址栏URL
  3. URL格式: `https://xxx.feishu.cn/base/DaRUb3J4Ba7G7FsMVlpcFJolnzd?table=xxx`
  4. 其中 `DaRUb3J4Ba7G7FsMVlpcFJolnzd` 就是应用Token

### 2. 表格ID (Table ID)  
- **位置**: 在飞书多维表格的URL中
- **格式**: 类似 `tblM4mby6pl1zXdL`
- **获取方法**:
  1. 在多维表格中，点击具体的表格标签
  2. 查看浏览器地址栏URL
  3. URL格式: `https://xxx.feishu.cn/base/xxx?table=tblM4mby6pl1zXdL&view=xxx`
  4. 其中 `tblM4mby6pl1zXdL` 就是表格ID

### 3. 访问令牌 (Access Token)
- **位置**: 飞书开放平台
- **格式**: 类似 `t-g1048gkkI3UPZ5LW6SWOOFUNAWJFDFEIVRLL4WRH`
- **获取方法**:
  1. 访问 [飞书开放平台](https://open.feishu.cn/)
  2. 登录并创建应用（如果还没有）
  3. 在应用管理页面，获取访问令牌
  4. 或者使用API调试工具临时获取令牌

## 🔧 配置步骤

### 第一步：启动代理服务器（重要！）
由于浏览器的CORS安全策略，需要启动代理服务器来转发API请求。

**注意**：如果你已经为ASR功能启动了代理服务器，则无需重复启动，飞书API会复用同一个代理服务器。

**启动命令**：
```bash
# 以下任一命令都可以
node dev-proxy.js
# 或者
npm run dev
```

**启动成功标志**：
- 看到 "CORS proxy listening on http://localhost:3001"
- 看到 "Health check: http://localhost:3001/healthz"
- 保持终端窗口打开

### 第二步：配置飞书信息
1. **点击设置按钮**: 在应用右上角点击齿轮图标
2. **填写飞书配置**: 在"飞书多维表格配置"部分填入上述三个信息
3. **保存配置**: 点击"保存配置"按钮

### 第三步：测试导入
1. **确保代理服务器正在运行**
2. **进入任意录音详情页**
3. **点击"导入台账"按钮测试**

## ⚠️ 注意事项

- **代理服务器**: 必须先启动代理服务器，否则会出现CORS错误
- **访问令牌有效期**: 访问令牌可能有时效性，如果导入失败，请检查令牌是否过期
- **权限要求**: 确保你的飞书账号有对应表格的编辑权限
- **端口占用**: 确保3001端口未被其他程序占用
- **网络连接**: 确保能正常访问飞书API
- **表格字段**: 确保表格包含以下字段：
  - 业务类别
  - 客户姓名
  - 客户画像
  - 跟进计划
  - 需求激发
  - 异议处理
  - 打动客户的点
  - 失败复盘
  - 延伸思考
  - 转录文本

## 🆘 常见问题

**Q: 出现CORS错误怎么办？**
A: 确保已启动代理服务器（node proxy-server.js），并且代理服务器正在运行

**Q: "代理服务器未运行"错误？**
A: 运行 `node dev-proxy.js` 或 `npm run dev` 启动代理服务器，确保看到启动成功的消息

**Q: 找不到应用Token怎么办？**
A: 确保你在多维表格页面，URL中包含 `/base/` 的部分就是应用Token

**Q: 访问令牌在哪里获取？**
A: 在飞书开放平台的应用管理页面，或使用你提供的示例中的令牌

**Q: 导入失败怎么办？**
A: 检查控制台错误信息，通常是配置信息错误或权限问题

**Q: 端口3001被占用怎么办？**
A: 修改 dev-proxy.js 中的 PORT 变量，同时更新前端代码中的代理地址

## 📞 技术支持

如果遇到配置问题，请检查浏览器控制台的错误信息，或联系技术支持。
